# 演讲评分系统

一个功能完整的演讲评分系统，支持多人协作、实时评分、云端同步等功能。

## ✨ 主要特性

- 🎯 **实时评分** - 评委提交评分后，管理员界面自动更新
- 🔄 **云端同步** - 基于 LeanCloud 的数据同步，支持多设备协同
- 📊 **评分进度** - 实时显示每个演讲者的评分状态
- 👥 **多角色支持** - 管理员、评委、演讲者三种角色
- 📱 **移动端适配** - 支持手机、平板等移动设备
- 💾 **多种存储** - 内存存储、本地存储、云端存储三种模式

---

## 🚀 快速开始

### 本地运行

#### 方法1：使用启动脚本（推荐）
```bash
# Windows
双击运行：启动系统.bat

# 或者使用命令行
启动系统.bat
```

#### 方法2：使用 Python
```bash
python -m http.server 8080
```
然后访问：http://localhost:8080

#### 方法3：使用 Node.js
```bash
npx http-server -p 8080 -c-1 --cors
```
然后访问：http://localhost:8080

⚠️ **注意：** 不能直接双击 index.html 文件，必须通过本地服务器运行！

---

## 🌐 部署到网上

想让任何人都能通过网址访问？查看部署文档：

- **快速部署** → `快速部署.md`（20分钟完成）
- **详细指南** → `部署指南.md`（多种方案对比）
- **部署总结** → `部署总结.md`（完整概览）

### 推荐方案：Gitee Pages（免费 + 国内快速）

1. 注册 Gitee 账号：https://gitee.com/
2. 创建公开仓库
3. 上传文件
4. 开启 Gitee Pages
5. 获取访问地址

**详细步骤请查看 `快速部署.md`**

---

## 📋 主要功能

### 1. 用户管理
- ✅ 添加/删除用户
- ✅ 批量导入用户（Excel）
- ✅ 角色分配（演讲者/评委）
- ✅ 自动/随机分配角色

### 2. 班级管理
- ✅ 创建/编辑/删除班级
- ✅ 固定班级（友好101、友好102、友好103）
- ✅ 班级切换
- ✅ 班级数据隔离

### 3. 评分系统
- ✅ 多维度评分（6个评分项目）
- ✅ 去掉最高最低分求平均值
- ✅ 实时评分进度显示
- ✅ 评分状态可视化

### 4. 云端同步
- ✅ 实时数据同步（5秒轮询）
- ✅ 增量更新机制
- ✅ 多设备协同工作
- ✅ 网络状态自动感知

### 5. 数据管理
- ✅ 三种存储模式
- ✅ 导出 Excel 格式结果
- ✅ 历史记录查看
- ✅ 数据备份恢复

---

## 👥 用户角色

### 管理员
- 用户管理（添加、删除、批量导入）
- 班级管理（创建、切换、删除）
- 角色分配（演讲者、评委）
- 开始评分
- 实时查看评分进度
- 查看结果并导出

### 评委
- 查看演讲者列表
- 为演讲者评分（6个维度）
- 一键提交所有评分
- 导出个人评分记录

### 演讲者
- 查看评分进度
- 查看最终得分
- 查看评分详情

---

## 📖 使用流程

### 1. 管理员操作
```
1. 访问系统网址
2. 管理员登录（admin / 123456）
3. 选择或创建班级
4. 添加用户（手动或批量导入）
5. 分配角色（演讲者和评委）
6. 点击"开始评分"
7. 实时查看评分进度
8. 查看结果并导出
```

### 2. 评委操作
```
1. 访问系统网址（带会话ID）
2. 评委登录（输入姓名）
3. 为每位演讲者评分
4. 点击"提交评分"或"一键提交所有评分"
5. 导出个人评分记录（可选）
```

### 3. 演讲者操作
```
1. 访问系统网址（带会话ID）
2. 演讲者登录（输入姓名）
3. 查看评分进度
4. 查看最终得分
```

---

## 📊 评分标准

| 评分项目 | 满分 | 说明 |
|---------|------|------|
| 讲稿内容 | 40分 | 内容质量、逻辑性、创新性 |
| 语速 | 10分 | 语速适中、节奏把控 |
| 停顿强调 | 10分 | 重点突出、停顿恰当 |
| 流利度 | 15分 | 表达流畅、无卡顿 |
| 衣着形象 | 10分 | 着装得体、仪表端庄 |
| 肢体语言 | 15分 | 手势自然、表情丰富 |
| **总分** | **100分** | |

**计分方法：** 去掉最高分和最低分，取平均值

---

## 💾 存储模式

### 内存存储
- 数据临时保存在浏览器内存
- 刷新页面后数据丢失
- 适合临时测试

### 本地存储
- 数据持久化保存在浏览器
- 刷新页面后数据保留
- 适合单机使用

### 云端存储（推荐）
- 数据保存在 LeanCloud 云端
- 可以跨设备访问
- 支持多人协作
- 实时数据同步

---

## 🔄 云端同步机制

### 时间戳增量轮询

系统采用**时间戳增量轮询**机制，实现高效的数据同步：

**工作原理：**
1. 记录最后同步时间戳
2. 每5秒查询一次云端数据
3. 只获取时间戳之后的新数据
4. 自动合并到本地数据
5. 更新界面显示

**优势：**
- ⚡ 数据传输量减少90%以上
- 🚀 同步速度快
- 💰 服务器负载低
- 🎯 精准的数据同步

**功能特点：**
- 自动检测管理员/评委界面
- 只在对应界面打开时更新
- 网络断开自动停止轮询
- 网络恢复自动重启轮询

---

## 🎯 固定班级

系统预设了三个固定班级，包含学生名单：

1. **友好101**（37人）
2. **友好102**（40人）
3. **友好103**（27人）

固定班级特点：
- ✅ 自动加载学生名单
- ✅ 不能删除班级
- ✅ 不能编辑班级名称
- ✅ 数据独立存储

---

## 📁 项目结构

```
SpeakerMvp/
├── index.html                  # 主页面
├── script.js                   # 核心逻辑
├── styles.css                  # 样式文件
├── fixed_classes_data.js       # 固定班级数据
├── memory_storage.js           # 内存存储
├── storage_adapter.js          # 存储适配器
├── 启动系统.bat                # 本地启动脚本
├── 清除缓存并启动.bat          # 清除缓存启动
├── 清理日志.bat                # 清理调试日志
├── README.md                   # 本文档
├── 部署指南.md                 # 详细部署文档
├── 快速部署.md                 # 快速部署清单
├── 部署总结.md                 # 部署总结
└── 部署文件清单.txt            # 文件清单
```

---

## 🔧 系统要求

### 浏览器
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

### 网络
- 使用云端存储时需要网络连接
- 本地存储和内存存储可离线使用

### 设备
- 电脑（Windows、Mac、Linux）
- 手机（iOS、Android）
- 平板（iPad、Android平板）

---

## ⚠️ 注意事项

### 1. 会话ID管理
- 管理员创建会话后，记录会话ID
- 评委和演讲者需要输入相同的会话ID
- 会话ID显示在页面顶部

### 2. 数据同步
- 评委提交评分后，数据会自动保存到云端
- 管理员界面每5秒自动刷新一次
- 切换班级后，轮询会自动重启

### 3. 固定班级
- 固定班级不能清除用户
- 如需清除，请切换到其他班级

### 4. 浏览器缓存
- 更新代码后，用户需要清除浏览器缓存
- 按 Ctrl+F5 强制刷新页面

### 5. 数据备份
- 定期导出评分结果
- 重要数据建议使用云端存储
- 定期备份 LeanCloud 数据

---

## 🆘 常见问题

### Q1: 如何批量导入用户？
**A:** 点击"导入Excel表格"按钮，选择Excel文件（第一列为用户名）

### Q2: 评委看不到评分界面？
**A:** 
1. 确保管理员已点击"开始评分"
2. 检查会话ID是否正确
3. 确认评委姓名在评委列表中

### Q3: 管理员界面不更新？
**A:** 
1. 检查轮询是否启动（控制台查看）
2. 确认网络连接正常
3. 检查 LeanCloud 配置是否正确
4. 尝试手动刷新页面

### Q4: 如何切换存储模式？
**A:** 点击左上角"数据存储管理"面板，选择存储模式

### Q5: 如何清除调试日志？
**A:** 运行 `清理日志.bat` 脚本，会自动清理所有 console.log

### Q6: 如何部署到网上？
**A:** 查看 `快速部署.md` 文档，推荐使用 Gitee Pages（免费）

---

## 🔍 调试技巧

### 查看轮询状态
```javascript
// 在浏览器控制台（F12）执行
console.log('轮询状态:', system.isPolling);
console.log('轮询频率:', system.pollingFrequency);
console.log('会话ID:', system.sessionId);
```

### 手动触发同步
```javascript
// 手动触发一次数据同步
await system.fetchIncrementalUpdates();
```

### 查看评分数据
```javascript
// 查看本地评分数据
console.log('评分数据:', system.scores);
```

### 查看云端数据
```javascript
// 查询云端评分数据
const SessionData = AV.Object.extend('SessionData');
const query = new AV.Query(SessionData);
query.equalTo('sessionId', system.sessionId);
query.equalTo('dataType', 'scores');
const results = await query.find();
console.log('云端数据数量:', results.length);
```

---

## 📝 更新日志

### V6.0.20 (2025-10-09) 🎉
- ✨ 修复切换班级后轮询未重启的问题
- 🔄 增加强制重启轮询选项
- 📊 完善评分进度显示
- 🐛 修复评委评分数据不保存到云端的问题
- 📖 完整的部署文档

### V6.0.19 (2025-10-09)
- 🔍 增加详细的轮询启动日志
- 🐛 修复轮询启动失败的问题

### V6.0.18 (2025-10-09)
- ✨ 评委评分数据自动保存到云端
- 🔄 完善数据同步机制

### V6.0.17 (2025-10-09)
- 🐛 修复时间戳边界问题
- ⚡ 优化轮询查询逻辑

### V6.0.16 (2025-10-09)
- 📊 新增实时评分进度显示
- 🎨 美化评分进度界面

### V6.0.15 (2025-10-09)
- 🔄 新增时间戳增量轮询机制
- 🚀 数据同步性能提升90%
- 🎛️ 新增云端同步控制面板
- 🌐 网络状态自动感知

---

## 📞 技术支持

### 文档
- **使用指南** → 本 README.md
- **部署指南** → `部署指南.md`
- **快速部署** → `快速部署.md`
- **部署总结** → `部署总结.md`

### 调试
- 打开浏览器控制台（F12）查看日志
- 查看网络请求是否正常
- 检查 LeanCloud 配置

### 问题反馈
如有问题，请提供：
1. 浏览器版本
2. 控制台错误信息
3. 操作步骤
4. 问题截图

---

## 📄 许可证

本项目仅供学习和教学使用。

---

## 🎉 致谢

感谢所有使用和支持本项目的用户！

---

**演讲评分系统 V6.0.20** - 让评分更简单、更高效！

🌟 如果觉得好用，请给个 Star！
